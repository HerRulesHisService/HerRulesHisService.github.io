<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kink Terminology Quiz</title>
    <!-- Load Tailwind CSS for responsive, modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for a dark, thematic feel */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        :root {
            --primary-color: #7c3aed; /* Violet 600 */
            --background-color: #0f172a; /* Slate 900 - Deep, dark background */
            --text-color: #f8fafc; /* Slate 50 */
            --card-color: #1e293b; /* Slate 800 - Card background */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .quiz-card {
            max-width: 800px;
            width: 100%;
            background-color: var(--card-color);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        .option-button {
            transition: all 0.2s ease;
        }
        /* Custom state colors */
        .correct {
            background-color: #10b981 !important; /* Emerald 500 */
            border-color: #059669 !important;
            color: #000 !important;
        }
        .incorrect {
            background-color: #ef4444 !important; /* Red 500 */
            border-color: #dc2626 !important;
            color: #000 !important;
        }
        /* Ensure cursor changes on interactive buttons */
        button:not([disabled]) {
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="app" class="quiz-card p-6 sm:p-10 rounded-xl space-y-8">
        <header class="text-center">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-white mb-2">Kink Terminology Quiz</h1>
            <p class="text-lg text-slate-400">Test your knowledge of the D/s, BDSM, and Kink landscape.</p>
        </header>

        <!-- Initial Load Screen (Visible until CSV is processed) -->
        <div id="loadingScreen" class="text-center py-10">
            <p class="text-xl text-slate-300 mb-4">Loading quiz data...</p>
            <div id="loader" class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-color mx-auto"></div>
        </div>

        <!-- Start/Restart Screen (Thematic Introduction) -->
        <div id="startScreen" class="text-center py-10 hidden">
            <!-- Thematic Introductory Text -->
            <div class="mb-8 p-6 rounded-lg bg-slate-700/50 border border-slate-600">
                <p class="text-xl font-medium text-slate-200 italic">
                    Step into the world where **words hold power**.
                </p>
                <p class="mt-4 text-slate-300">
                    Before any journey into the realms of **dynamic play** or **conscious intimacy**, understanding the map is essential. Test your fluency in the language of consent, boundaries, and pleasure. Only then can you truly explore.
                </p>
            </div>

            <h2 class="text-3xl font-bold mb-4 text-primary-color">Quiz Ready!</h2>
            <p id="readyMessage" class="text-xl text-slate-300 mb-6">0 questions loaded.</p>
            <button id="startButton" class="px-10 py-4 text-xl font-bold rounded-lg bg-primary-color text-white hover:bg-violet-700 transition duration-150 shadow-lg shadow-violet-800/50">
                Begin the Exploration
            </button>
        </div>

        <!-- Quiz Content Area -->
        <div id="quizContent" class="hidden">
            <!-- Score & Progress -->
            <div class="flex justify-between items-center text-sm sm:text-base mb-6 text-slate-300">
                <span id="scoreDisplay" class="font-semibold">Score: 0</span>
                <span id="progressDisplay">Question 0/0</span>
            </div>

            <!-- Question Card -->
            <div class="bg-slate-700 p-5 rounded-lg border-2 border-slate-600">
                <p id="questionText" class="text-2xl font-bold mb-4 text-white">Loading Question...</p>
                <p class="text-sm text-slate-400">Select the correct definition for the term above.</p>
            </div>

            <!-- Options Grid -->
            <div id="optionsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                <!-- Options buttons are dynamically inserted here -->
            </div>

            <!-- Feedback and Next Button -->
            <div id="feedbackContainer" class="mt-6">
                <p id="feedbackText" class="text-center text-lg font-semibold h-6"></p>
                <div class="flex justify-center mt-4">
                    <button id="nextButton" disabled
                        class="px-8 py-3 text-lg font-bold rounded-lg bg-slate-500 text-white hover:bg-slate-400 disabled:opacity-50 transition duration-150">
                        Next Question
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="text-center py-10 hidden">
            <h2 class="text-4xl font-bold text-primary-color mb-4">Quiz Complete!</h2>
            <p class="text-2xl text-slate-300 mb-6">Your final score is:</p>
            <p id="finalScore" class="text-6xl font-extrabold text-white mb-8"></p>
            <button id="restartButton" class="px-10 py-4 text-xl font-bold rounded-lg bg-primary-color text-white hover:bg-violet-700 transition duration-150">
                Play Again
            </button>
        </div>
    </div>

    <!-- JavaScript Quiz Logic -->
    <script>
        // Set the expected path for the CSV data file
        const CSV_FILEPATH = 'kinkwordquiz.csv';

        // State variables
        let allQuestions = [];
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let answered = false;
        
        // Cache DOM elements
        const loadingScreen = document.getElementById('loadingScreen');
        const startScreen = document.getElementById('startScreen');
        const quizContent = document.getElementById('quizContent');
        const resultsScreen = document.getElementById('resultsScreen');

        const startButton = document.getElementById('startButton');
        const nextButton = document.getElementById('nextButton');
        const restartButton = document.getElementById('restartButton');
        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const feedbackText = document.getElementById('feedbackText');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const progressDisplay = document.getElementById('progressDisplay');
        const finalScore = document.getElementById('finalScore');
        const readyMessage = document.getElementById('readyMessage');

        // Utility function to shuffle an array (Fisher-Yates algorithm)
        const shuffleArray = (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        };

        // --- Core Functions ---

        /**
         * Loads and parses the CSV data from the external file.
         */
        const loadCSV = async () => {
            try {
                const response = await fetch(CSV_FILEPATH);
                if (!response.ok) {
                    throw new Error(`Failed to fetch ${CSV_FILEPATH}: ${response.statusText}`);
                }
                const csvText = await response.text();
                
                // Parse CSV text
                const rows = csvText.trim().split('\n');
                // Skip header row
                const dataRows = rows.slice(1);

                allQuestions = dataRows.map(row => {
                    // Simple split works, assuming definitions do not contain commas
                    const [term, correct, w1, w2, w3] = row.split(',').map(s => s.trim());
                    
                    if (!term || !correct) return null; // Skip invalid rows

                    // Filter out empty wrong definitions and ensure we have 4 options
                    return {
                        term: term,
                        correctDefinition: correct,
                        options: [correct, w1, w2, w3].filter(d => d && d !== '').slice(0, 4) 
                    };
                }).filter(q => q && q.options.length === 4);

                console.log(`Loaded ${allQuestions.length} valid questions.`);
                
                if (allQuestions.length === 0) {
                    throw new Error("No valid questions were parsed from the CSV. Ensure the file exists and is correctly formatted.");
                }

                // Transition from loading to start screen
                loadingScreen.classList.add('hidden');
                readyMessage.textContent = `${allQuestions.length} questions loaded.`;
                startScreen.classList.remove('hidden');

            } catch (error) {
                console.error("Error loading or parsing CSV:", error);
                // Display error message to user
                loadingScreen.classList.remove('hidden');
                loadingScreen.innerHTML = `<p class="text-xl text-red-500 text-center">Error: Could not load quiz data. Please ensure the file \`${CSV_FILEPATH}\` exists in the same directory.</p>`;
                startScreen.classList.add('hidden');
                quizContent.classList.add('hidden');
            }
        };

        /**
         * Initializes the game state and starts the quiz.
         */
        const startGame = () => {
            score = 0;
            currentQuestionIndex = 0;
            answered = false;
            
            // Create a fresh, shuffled list of questions for this round
            currentQuestions = shuffleArray([...allQuestions]);
            
            // Hide control screens, show quiz content
            startScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
            quizContent.classList.remove('hidden');

            updateScoreDisplay();
            displayQuestion();
        };

        /**
         * Displays the current question and its shuffled options.
         */
        const displayQuestion = () => {
            if (currentQuestionIndex >= currentQuestions.length) {
                showResults();
                return;
            }

            const currentQ = currentQuestions[currentQuestionIndex];
            
            // Reset state
            answered = false;
            feedbackText.textContent = '';
            nextButton.disabled = true;
            nextButton.classList.remove('bg-primary-color', 'hover:bg-violet-700');
            nextButton.classList.add('bg-slate-500', 'hover:bg-slate-400');
            optionsContainer.innerHTML = ''; // Clear previous options

            // Update question and progress
            questionText.textContent = currentQ.term;
            progressDisplay.textContent = `Question ${currentQuestionIndex + 1}/${currentQuestions.length}`;

            // Shuffle options and create buttons
            const shuffledOptions = shuffleArray([...currentQ.options]);

            shuffledOptions.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                // Add option-button class for styling and event handling
                button.className = 'option-button p-4 text-left rounded-lg border-2 border-slate-600 bg-slate-700 hover:bg-slate-600 text-slate-200 text-base md:text-lg focus:outline-none';
                button.onclick = () => checkAnswer(button, option, currentQ.correctDefinition);
                optionsContainer.appendChild(button);
            });
        };

        /**
         * Checks the user's selected answer and provides feedback.
         */
        const checkAnswer = (selectedButton, selectedOption, correctDefinition) => {
            if (answered) return; // Prevent double clicking after answer is chosen

            answered = true;
            const isCorrect = selectedOption === correctDefinition;
            const buttons = optionsContainer.querySelectorAll('.option-button');

            buttons.forEach(btn => {
                btn.disabled = true; // Disable all options
                if (btn.textContent === correctDefinition) {
                    // Mark the correct answer
                    btn.classList.add('correct');
                } else if (btn === selectedButton) {
                    // Mark incorrect selection
                    btn.classList.add('incorrect');
                }
            });

            if (isCorrect) {
                score++;
                feedbackText.textContent = 'Correct! Fluent in the language of power.';
                feedbackText.classList.remove('text-red-500');
                feedbackText.classList.add('text-emerald-500');
            } else {
                feedbackText.textContent = 'Incorrect. Review the highlighted term.';
                feedbackText.classList.remove('text-emerald-500');
                feedbackText.classList.add('text-red-500');
            }

            updateScoreDisplay();
            // Enable Next button
            nextButton.disabled = false;
            nextButton.classList.remove('bg-slate-500', 'hover:bg-slate-400');
            nextButton.classList.add('bg-primary-color', 'hover:bg-violet-700');
            nextButton.textContent = currentQuestionIndex < currentQuestions.length - 1 ? 'Next Question' : 'Finish Quiz';
        };

        /**
         * Advances to the next question or finishes the quiz.
         */
        const nextQuestion = () => {
            currentQuestionIndex++;
            displayQuestion();
        };

        /**
         * Updates the score and progress displays.
         */
        const updateScoreDisplay = () => {
            scoreDisplay.textContent = `Score: ${score}`;
        };

        /**
         * Shows the final results screen.
         */
        const showResults = () => {
            quizContent.classList.add('hidden');
            finalScore.textContent = `${score} / ${currentQuestions.length}`;
            resultsScreen.classList.remove('hidden');
        };


        // --- Event Listeners ---
        startButton.addEventListener('click', startGame);
        nextButton.addEventListener('click', nextQuestion);
        restartButton.addEventListener('click', startGame);

        // --- Initialization ---
        // Load the CSV data when the window is fully loaded
        window.onload = loadCSV;
    </script>
</body>
</html>
